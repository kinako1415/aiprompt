# 02. 機能要件

## 🏗️ 機能概要

### 機能分類

本アプリケーションの機能は以下の 6 つの主要カテゴリに分類されます：

1. **プロンプト管理・検索機能**
2. **プロンプト改善・評価機能**
3. **テンプレート機能**
4. **コラボレーション・共有機能**
5. **AI 連携機能**
6. **その他便利機能**

### 実装済み機能概要

#### ✅ フロントエンド実装完了

- **ヘッダーコンポーネント**: 検索バー、通知ドロップダウン、ユーザーメニュー
- **サイドバーナビゲーション**:
  - メインメニュー（8 項目、バッジ付き統計）
  - カテゴリフィルター（6 カテゴリ、色分けと件数表示）
  - タグフィルター（5 種類の基本タグ）
  - 作成日フィルター
- **ダッシュボード**:
  - 4 種類の統計カード（プロンプト数、評価、使用数、改善率）
  - 5 つのタブナビゲーション
  - グリッド・リスト表示切り替え
  - ソート・フィルター・操作ボタン群
- **プロンプトカード**:
  - 完全な情報表示（タイトル、説明、カテゴリ、タグ、統計、作成者）
  - インタラクション（ホバー効果、アクションメニュー）
  - 状態管理（お気に入り、公開状態）
- **プロンプトエディター**:
  - モーダルダイアログ（Radix UI Dialog）
  - 4 タブ構成（エディター、プレビュー、AI 提案、分析）
  - プロンプト構成要素ガイド（6 要素）
  - フォーム管理とバリデーション

#### 🔄 実装予定機能（バックエンド・統合）

- **API 連携**: RESTful API 設計、データベース統合
- **AI 連携**: OpenAI/Claude API 統合、プロンプト実行・評価
- **ユーザー認証**: NextAuth.js、ソーシャルログイン
- **リアルタイム機能**: WebSocket、プッシュ通知、自動保存
- **データ永続化**: PostgreSQL、Redis キャッシュ
- **検索機能**: Elasticsearch、オートコンプリート

---

## 1. 📥 プロンプト管理・検索機能

### 1.1 プロンプトの保存と分類

#### 1.1.1 基本情報管理

**実装状況**: ✅ UI 完了、🔄 バックエンド統合予定

**実装済み UI 項目**:

- ✅ **ID**: 一意識別子（サンプルデータで実装済み）
- ✅ **タイトル**: Input コンポーネント（必須入力、バリデーション）
- ✅ **説明文**: Textarea コンポーネント（複数行、文字数カウント）
- ✅ **コンテンツ**: 大きな Textarea（プロンプト本文編集）
- ✅ **カテゴリ**: Badge 表示、選択 UI（6 カテゴリ対応）
- ✅ **タグ配列**: マルチタグ入力（Badge + 削除ボタン）
- ✅ **作成日時・更新日時**: 表示フォーマット対応
- ✅ **作成者情報**: Avatar + 名前表示

**実装済み表示項目**:

- ✅ **公開・非公開設定**: "公開" Badge 表示
- ✅ **お気に入り**: Heart アイコン + 状態切り替え
- ✅ **評価システム**: Star + 数値（4.8 等）+ 評価件数
- ✅ **統計情報**: Eye（閲覧数）、Heart（いいね数）、使用数表示

**予定統合機能**:

- 🔄 データベース永続化（PostgreSQL）
- 🔄 バリデーション強化（Zod、React Hook Form）
- 🔄 画像アップロード（S3 統合）
- 🔄 自動保存機能

#### 1.1.2 カテゴリ分類

**実装状況**: ✅ UI 完了、✅ フロントエンド統合完了

**実装済みカテゴリ一覧**:

- ✅ **文章生成**: 記事、メール、企画書等（87 件、青色 Badge）
- ✅ **画像生成**: イラスト、写真、デザイン等（23 件、緑色 Badge）
- ✅ **コード生成**: プログラミング、スクリプト等（45 件、紫色 Badge）
- ✅ **分析・要約**: データ分析、文書要約等（34 件、オレンジ色 Badge）
- ✅ **翻訳**: 多言語翻訳、言語処理（19 件、赤色 Badge）
- ✅ **アイデア出し**: ブレインストーミング（31 件、黄色 Badge）

**実装済み機能**:

- ✅ カテゴリ別統計カウント（Badge での件数表示）
- ✅ 色分けによる視覚的識別（categoryColors システム）
- ✅ サイドバーでのフィルター機能（Collapsible UI）
- ✅ カテゴリ別プロンプト一覧表示
- ✅ プロンプトカードでのカテゴリ表示

**実装詳細**:

```typescript
const categoryColors = {
  文章生成: "bg-blue-100 text-blue-800 border-blue-200",
  画像生成: "bg-green-100 text-green-800 border-green-200",
  コード生成: "bg-purple-100 text-purple-800 border-purple-200",
  // ... 他カテゴリ
};
```

**予定拡張機能**:

- 🔄 ユーザーによるカスタムカテゴリ作成
- 🔄 AI による カテゴリ自動提案
- 🔄 カテゴリ階層管理（親・子カテゴリ）

#### 1.1.3 タグ付けシステム

**実装状況**: ✅ UI 完了、🔄 AI 統合予定

**実装済みタグ機能**:

- ✅ タグ入力・編集（Input + Badge コンポーネント）
- ✅ タグ削除（X ボタンクリック）
- ✅ プロンプトカードでのタグ表示（最大表示数制限）
- ✅ サイドバーでのタグフィルター（5 基本タグ実装）

**実装済み基本タグ**:

- ✅ **チャット**: 対話型プロンプト
- ✅ **コード**: プログラミング関連
- ✅ **画像**: 画像生成・編集
- ✅ **分析**: データ分析・調査
- ✅ **翻訳**: 多言語・言語処理

**タグの種類（拡張予定）**:

- 🔄 **用途タグ**: チャット、コード生成、文書作成、画像生成等
- 🔄 **プロジェクトタグ**: プロジェクト名、クライアント名等
- 🔄 **品質タグ**: 高品質、実験的、改善中等
- 🔄 **難易度タグ**: 初級、中級、上級
- 🔄 **カスタムタグ**: ユーザー独自のタグ

**AI 自動タグ提案機能（予定）**:

- 🔄 プロンプト内容を解析してタグを自動提案
- 🔄 用途、対象 AI モデル、難易度を自動判定
- 🔄 ユーザーによる手動編集・追加が可能

#### 1.1.4 お気に入り・重要度管理

**実装状況**: ✅ UI 完了、🔄 データ統合予定

**実装済み機能**:

- ✅ **お気に入り**: Heart アイコン + 状態切り替え（PromptCard）
- ✅ **お気に入り数表示**: いいね数の可視化
- ✅ **お気に入りフィルター**: サイドバーメニュー（⭐ お気に入り - Badge: 12）
- ✅ **視覚的フィードバック**: ハート色変化、状態表示

**機能詳細**:

- ✅ **お気に入り切り替え**: onToggleFavorite コールバック実装
- ✅ **状態管理**: isFavorite プロパティによる状態管理
- ✅ **統計表示**: お気に入り一覧での件数表示
- ✅ **アクセス**: サイドバーからのクイックアクセス

**予定拡張機能**:

- 🔄 **重要度レベル**: 5 段階の重要度設定（1-5 星）
- 🔄 **使用頻度追跡**: 自動計算による頻繁使用プロンプトの識別
- 🔄 **最終使用日**: 最後に使用した日時の記録・表示
- 🔄 **個人化**: ユーザー別のお気に入り管理

### 1.2 強力な検索機能

#### 1.2.1 基本検索

**機能概要**: 基本的な検索機能

**検索対象**:

- プロンプトタイトル
- プロンプト本文
- 説明文
- タグ
- カテゴリ

**検索方式**:

- キーワード検索（部分一致・完全一致）
- 正規表現検索
- ファジー検索（曖昧検索）

#### 1.2.2 詳細検索・フィルタリング

**機能概要**: 多面的な絞り込み検索

**フィルタ項目**:

- **カテゴリフィルタ**: 単一・複数カテゴリ選択
- **タグフィルタ**: AND/OR 条件での複数タグ検索
- **作成日範囲**: 指定期間内の作成プロンプト
- **最終使用日範囲**: 指定期間内の使用プロンプト
- **評価スコア範囲**: 評価点数での絞り込み
- **使用回数範囲**: 使用頻度での絞り込み
- **お気に入り**: お気に入り登録済みのみ
- **作成者**: 特定ユーザーのプロンプト
- **AI モデル**: 対象 AI モデルでの絞り込み

#### 1.2.3 ソート機能

**ソート条件**:

- 作成日時（新しい順・古い順）
- 更新日時（新しい順・古い順）
- 最終使用日時（新しい順・古い順）
- 使用回数（多い順・少ない順）
- 評価スコア（高い順・低い順）
- タイトル（あいうえお順・アルファベット順）
- 関連度（検索時のマッチ度）

#### 1.2.4 保存された検索

**機能概要**: よく使う検索条件の保存

**機能詳細**:

- 検索条件の名前付き保存
- 保存された検索のクイックアクセス
- 検索条件の共有（チーム内）
- 検索結果の自動更新通知

### 1.3 バージョン管理

#### 1.3.1 自動バージョン保存

**機能概要**: プロンプトの変更履歴を自動保存

**機能詳細**:

- プロンプト内容変更時の自動バックアップ
- 変更差分の可視化（diff 表示）
- 変更理由のコメント記録
- 変更者の記録

#### 1.3.2 バージョン比較・復元

**機能詳細**:

- 任意の 2 つのバージョン間の比較
- サイドバイサイド表示
- 特定バージョンへの復元機能
- バージョンブランチング（実験的変更）

#### 1.3.3 変更履歴の分析

**機能詳細**:

- 各バージョンでの AI 出力品質の記録
- 変更による改善効果の可視化
- 成功パターンの抽出と提案

### 1.5 ダッシュボード統計機能（実装済み）

#### 1.5.1 統計カード表示

**実装済み統計項目**:

1. **総プロンプト数**

   - 現在値: 243
   - 増減: +12（正の変化、緑色表示）
   - アイコン: FileText

2. **平均評価**

   - 現在値: 4.2
   - 増減: +0.3（正の変化、緑色表示）
   - アイコン: Star

3. **今月の使用数**

   - 現在値: 1,847
   - 増減: +234（正の変化、緑色表示）
   - アイコン: Eye

4. **今月の改善率**
   - 現在値: 23%
   - 増減: +5%（正の変化、緑色表示）
   - アイコン: TrendingUp

#### 1.5.2 タブナビゲーション

**実装済みタブ**:

- すべて（全プロンプト表示）
- お気に入り（isFavorite=true のプロンプト）
- 最近使用（使用日時順）
- 高評価（評価順）
- カテゴリ別（カテゴリフィルタ）

#### 1.5.3 表示制御機能

**実装済み機能**:

- グリッド・リスト表示切り替えボタン
- ソート順選択（最新、人気、評価順等）
- フィルターボタン
- 新規作成ボタン
- インポートボタン

### 1.6 プロンプト作成・編集機能（実装済み）

#### 1.6.1 新規プロンプト作成専用ページ

**実装状況**: ✅ UI 完了、🔄 バックエンド統合予定

**ページ情報**:

- **URL**: `/prompts/new`
- **レイアウト**: 専用大画面ページ（ダイアログ型から変更）
- **アクセス**: プロンプト一覧ページの「新規作成」ボタン

**実装済み機能**:

##### 1.6.1.1 段階的ガイドモード

- ✅ **3 ステップ構成**: 基本情報 → プロンプト作成 → 確認・調整
- ✅ **プログレスバー**: 進捗の可視化（%表示）
- ✅ **ステップナビゲーション**: ステップ間の自由移動
- ✅ **バリデーション**: 各ステップでの入力チェック
- ✅ **ガイド ON/OFF**: 通常モードとの切り替え可能

**ステップ詳細**:

1. **基本情報ステップ**:

   - ✅ タイトル（必須、バリデーション付き）
   - ✅ 説明文（必須、複数行入力）
   - ✅ カテゴリー選択（6 カテゴリ対応）

2. **プロンプト作成ステップ**:

   - ✅ タブ式エディター（基本・構造化・高度）
   - ✅ プロンプト内容入力（必須、最小 10 文字）
   - ✅ 各種編集支援機能

3. **確認・調整ステップ**:
   - ✅ タグ追加・編集機能
   - ✅ プレビュー機能
   - ✅ 最終確認・保存

##### 1.6.1.2 UI/UX 機能

- ✅ **集中モード**: 補助機能を非表示にして編集に集中
- ✅ **プレビューパネル**: リアルタイムプレビュー（ON/OFF 可能）
- ✅ **自動保存**: 3 秒間隔での自動下書き保存
- ✅ **レスポンシブデザイン**: PC・タブレット対応
- ✅ **キャンセル確認**: 未保存時の離脱確認ダイアログ

##### 1.6.1.3 編集機能

**タブ式エディター**:

- ✅ **基本エディター**: シンプルなテキスト入力
- ✅ **構造化エディター**: プロンプト要素分解
- ✅ **高度エディター**: リッチテキスト編集機能

**補助機能タブ**:

- ✅ **AI 提案**: プロンプト改善提案（3 種類）
- ✅ **要素分解**: プロンプト構成要素ガイド（6 要素）
- ✅ **バージョン履歴**: 変更履歴の管理

##### 1.6.1.4 フォーム機能

- ✅ **入力バリデーション**: リアルタイム・送信時チェック
- ✅ **エラー表示**: 具体的なエラーメッセージ
- ✅ **必須項目**: タイトル、説明、カテゴリー、プロンプト内容
- ✅ **オプション項目**: タグ、その他メタデータ

##### 1.6.1.5 保存・ナビゲーション

- ✅ **保存処理**: 非同期保存、ローディング表示
- ✅ **成功時**: プロンプト一覧ページへリダイレクト
- ✅ **キャンセル**: 確認後、一覧ページへ戻る
- ✅ **戻るボタン**: ヘッダーにパンくずナビゲーション

**予定統合機能**:

- 🔄 **API バックエンド統合**: データベース永続化
- 🔄 **リアルタイム自動保存**: WebSocket による同期
- 🔄 **テンプレート連携**: 既存テンプレートからの作成
- 🔄 **AI 支援強化**: より高度な改善提案

#### 1.6.2 既存プロンプト編集機能

**実装状況**: ✅ ダイアログ型 UI 実装済み、🔄 専用ページ移行検討

**現在の実装**:

- ✅ モーダルダイアログ形式（画面全体サイズ）
- ✅ 新規作成と同一の編集機能
- ✅ バージョン履歴との統合

**移行検討事項**:

- 🔄 編集専用ページ（`/prompts/[id]/edit`）への移行
- 🔄 新規作成ページとのコンポーネント共通化
- 🔄 編集モード特有の UI（削除、複製、公開設定等）

---

## 2. 🧠 プロンプト改善・評価機能（実装予定）

### 2.1 結果の記録と評価

#### 2.1.1 AI 出力結果の記録

**機能概要**: プロンプトに対する AI の出力結果を保存

**記録項目**:

- **出力内容**: AI の生成結果（テキスト・画像 URL）
- **使用 AI モデル**: 使用した AI サービス・モデル
- **実行日時**: 結果取得の日時
- **実行パラメータ**: temperature、max_tokens 等
- **実行コスト**: API 使用料金（可能な場合）

#### 2.1.2 ユーザー評価システム

**機能概要**: 出力結果に対するユーザー評価

**評価方式**:

- **5 段階評価**: 1（非常に悪い）～ 5（非常に良い）
- **Good/Bad 評価**: シンプルな二択評価
- **観点別評価**:
  - 正確性（1-5 点）
  - 有用性（1-5 点）
  - 創造性（1-5 点）
  - 読みやすさ（1-5 点）
- **自由コメント**: 詳細な評価コメント（最大 1000 文字）

#### 2.1.3 評価データの分析

**機能詳細**:

- プロンプト別平均評価の算出
- 評価推移の可視化（時系列グラフ）
- 評価分布の表示（ヒストグラム）
- 高評価・低評価の要因分析

### 2.2 AI 支援によるプロンプト改善

#### 2.2.1 改善点の自動検出

**機能概要**: AI がプロンプトの問題点を分析

**分析観点**:

- **明確性**: 指示が曖昧でないか
- **具体性**: 十分に具体的な内容か
- **構造**: 論理的な構成になっているか
- **完全性**: 必要な情報が不足していないか
- **適切性**: 目的に対して適切な内容か

**フィードバック例**:

- "この部分の指示が曖昧です。より具体的に指定してください"
- "出力形式が明確でありません。例を追加することを推奨します"
- "ペルソナ設定を追加すると、より良い結果が得られる可能性があります"

#### 2.2.2 改善提案の生成

**機能概要**: 具体的な改善案を自動生成

**提案タイプ**:

- **構造改善**: プロンプトの構成変更提案
- **表現改善**: より効果的な表現への変更
- **要素追加**: 不足している要素の追加提案
- **例示追加**: 具体例やサンプルの追加提案

**提案の表示方式**:

- 変更前後の比較表示
- 変更理由の説明
- 期待される改善効果の説明
- ワンクリック適用機能

### 2.3 A/B テスト機能

#### 2.3.1 A/B テストの設定

**機能概要**: 複数バージョンのプロンプトを比較テスト

**設定項目**:

- **テスト名**: A/B テストの識別名
- **比較プロンプト**: 2 ～ 5 個のプロンプトバリエーション
- **テスト条件**: 同一の AI モデル・パラメータで実行
- **評価指標**: 比較に使用する評価基準
- **実行回数**: 各プロンプトの実行回数

#### 2.3.2 結果の比較分析

**機能詳細**:

- 各プロンプトの平均評価スコア
- 統計的有意性の検定
- 結果のばらつき分析
- 勝敗判定の自動化

#### 2.3.3 ベストプラクティスの抽出

**機能詳細**:

- 高性能プロンプトの共通パターン分析
- 成功要因の自動抽出
- 類似プロンプトへの応用提案

### 2.4 プロンプト要素分解・再構築

#### 2.4.1 要素分解機能

**機能概要**: プロンプトを構成要素に分解

**分解要素**:

- **目的・タスク**: 何をさせたいのか
- **ペルソナ・役割**: AI に演じてもらう役割
- **コンテキスト**: 背景情報・前提条件
- **制約・条件**: 守るべきルールや制限
- **出力形式**: 結果の形式・構造
- **例示**: 具体例やサンプル
- **トーン**: 文体や口調の指定

#### 2.4.2 要素ライブラリ

**機能詳細**:

- 各要素の再利用可能なライブラリ
- カテゴリ別の要素管理
- 高評価要素の自動収集
- カスタム要素の追加

#### 2.4.3 再構築支援

**機能詳細**:

- 要素の組み合わせ提案
- 最適な要素順序の提案
- 要素間の整合性チェック
- プレビュー機能

---

## 3. 🧩 テンプレート機能

### 3.1 自動変数抽出

#### 3.1.1 変数候補の自動検出

**機能概要**: プロンプトから変数化可能な部分を自動抽出

**抽出対象**:

- **固有名詞**: 人名、会社名、商品名等
- **数値**: 日付、金額、数量等
- **条件**: 具体的な条件や制約
- **例示**: 具体例として挙げられている内容

**抽出アルゴリズム**:

- 自然言語処理による固有名詞抽出
- パターンマッチングによる数値・日付抽出
- 文脈解析による変数候補の判定

#### 3.1.2 変数定義の生成

**機能詳細**:

- 変数名の自動生成（例：`{{商品名}}`, `{{対象日付}}`）
- 変数の型定義（文字列、数値、日付等）
- デフォルト値の設定
- 変数の説明文の自動生成

#### 3.1.3 ユーザーによる編集・調整

**機能詳細**:

- 変数名の手動変更
- 変数位置の調整
- 不要変数の削除
- 追加変数の手動定義

### 3.2 テンプレートの管理

#### 3.2.1 テンプレートの作成・保存

**機能詳細**:

- テンプレート名の設定
- 変数定義の保存
- テンプレートの説明・用途の記録
- カテゴリ・タグの設定

#### 3.2.2 テンプレートライブラリ

**機能詳細**:

- 個人テンプレートの管理
- 公開テンプレートの閲覧
- テンプレートの検索・フィルタリング
- 人気テンプレートランキング

#### 3.2.3 テンプレートの共有

**機能詳細**:

- チーム内でのテンプレート共有
- 公開テンプレートとしての公開
- 権限管理（閲覧・編集・複製）
- バージョン管理

### 3.3 テンプレートからの生成

#### 3.3.1 変数入力インターフェース

**機能詳細**:

- フォーム形式での変数入力
- 変数の型に応じた入力フィールド
- 入力値の検証
- プレビュー機能

#### 3.3.2 一括生成機能

**機能詳細**:

- CSV ファイルからの一括変数読み込み
- 複数プロンプトの一括生成
- 生成結果の一括保存
- 生成履歴の管理

---

## 4. 🤝 コラボレーション・共有機能

### 4.1 プロンプトの共有

#### 4.1.1 個別共有

**機能詳細**:

- プロンプトの個別共有 URL 生成
- 閲覧期限の設定
- パスワード保護
- 共有履歴の管理

#### 4.1.2 チーム共有

**機能詳細**:

- チーム内での自動共有
- チームライブラリの構築
- アクセス権限の管理
- 共有プロンプトの検索

### 4.2 共同編集機能

#### 4.2.1 リアルタイム共同編集

**機能詳細**:

- 複数ユーザーによる同時編集
- 変更のリアルタイム同期
- 編集者の可視化
- コンフリクト解決

#### 4.2.2 レビュー・承認機能

**機能詳細**:

- 変更提案機能
- レビューコメント
- 承認ワークフロー
- 変更履歴の管理

### 4.3 コミュニティ機能

#### 4.3.1 公開プロンプトギャラリー

**機能詳細**:

- 高品質プロンプトの公開
- カテゴリ別の整理
- 評価・レビュー機能
- いいね・フォロー機能

#### 4.3.2 フォーラム・ディスカッション

**機能詳細**:

- プロンプトに関する議論
- 質問・回答機能
- ベストプラクティスの共有
- 専門家による解説

---

## 5. 🤖 AI 連携機能

### 5.1 API 連携

#### 5.1.1 サポート AI サービス

**対応予定サービス**:

- OpenAI（GPT-4、GPT-3.5-turbo、DALL-E）
- Anthropic（Claude）
- Google（Gemini）
- Stability AI（Stable Diffusion）
- その他（プラグイン形式で拡張）

#### 5.1.2 統一インターフェース

**機能詳細**:

- 複数 AI サービスの統一操作
- サービス別パラメータ設定
- 結果の統一フォーマット
- コスト管理・追跡

### 5.2 プロンプト生成補助

#### 5.2.1 目的別プロンプト生成

**機能詳細**:

- ユーザーの目的・キーワード入力
- 最適なプロンプトテンプレート提案
- 段階的なプロンプト構築支援
- 生成プロンプトの品質チェック

#### 5.2.2 インタラクティブ生成

**機能詳細**:

- 対話形式でのプロンプト構築
- 質問に答えながら自動生成
- 途中での修正・調整
- 生成プロセスの保存

### 5.3 自動最適化

#### 5.3.1 遺伝的アルゴリズムによる最適化

**機能概要**: AI 自身がプロンプトを改良

**プロセス**:

1. 初期プロンプトの作成
2. 複数バリエーションの自動生成
3. 各バリエーションの性能評価
4. 高性能バリエーションの組み合わせ
5. 新世代プロンプトの生成
6. 収束まで反復

#### 5.3.2 目標設定と評価

**機能詳細**:

- 最適化目標の設定（品質、創造性、効率性等）
- 自動評価システムの構築
- 人間による評価との組み合わせ
- 最適化過程の可視化

---

## 6. 📊 その他の便利機能

### 6.1 統計・分析機能

#### 6.1.1 使用統計

**機能詳細**:

- プロンプト使用頻度の分析
- 時系列での使用傾向
- カテゴリ別使用状況
- AI モデル別使用状況

#### 6.1.2 パフォーマンス分析

**機能詳細**:

- プロンプト品質の推移
- 改善効果の測定
- ROI（投資対効果）の算出
- ベンチマーク比較

### 6.2 データのインポート・エクスポート

#### 6.2.1 エクスポート機能

**対応フォーマット**:

- JSON（構造化データ）
- CSV（表形式データ）
- Markdown（テキスト形式）
- PDF（レポート形式）

#### 6.2.2 インポート機能

**機能詳細**:

- 既存データの一括インポート
- 他ツールからの移行支援
- データ形式の自動変換
- 重複データの検出・処理

### 6.3 ショートカット・クイックアクセス

#### 6.3.1 キーボードショートカット

**機能詳細**:

- 新規プロンプト作成
- 検索機能の呼び出し
- よく使うプロンプトへのアクセス
- 各種機能への素早いアクセス

#### 6.3.2 クイックアクセス機能

**機能詳細**:

- 最近使用したプロンプト
- お気に入りプロンプト
- よく使うテンプレート
- 作業中プロンプト

---

## 7. 🤖 AI 支援プロンプト作成フロー機能（新規要件）

### 7.1 概要

ユーザーが簡単な入力から高品質なプロンプトを作成し、継続的に改善できる 4 段階のワークフローを実装します。

**フロー概要**:

1. **意図入力** → ユーザーが作りたいプロンプトの目的を自然言語で入力
2. **型提示** → AI が最適なプロンプト型（テンプレート）を複数提案
3. **実行・テスト** → 型に値を入力して AI で試行
4. **フィードバック・改善** → 結果を評価して型を自動改善

---

### 7.2 フェーズ 1: 意図入力・目的誘導

#### 7.2.1 フロントエンド要件

**UI コンポーネント**:

- **意図入力フィールド**: 大きなテキストエリア（プレースホルダー付き）
- **目的選択 UI**: カテゴリ別の選択肢（アイコン + 説明付き）
- **ガイド質問セクション**: 段階的な誘導質問
- **例示パネル**: 成功例とキーワード例の表示

```typescript
// 意図入力コンポーネントの型定義
interface IntentInputProps {
  onSubmit: (intent: UserIntent) => void;
  isLoading: boolean;
}

interface UserIntent {
  description: string; // 自由記述
  category: string; // 選択されたカテゴリ
  keywords: string[]; // キーワード配列
  targetAI: string[]; // 対象AIモデル
  outputType: string; // 期待する出力タイプ
}
```

**誘導質問システム**:

- **目的カテゴリ選択**:

  - 文章生成（ブログ、メール、企画書など）
  - 画像生成（イラスト、写真、デザインなど）
  - コード生成（プログラム、スクリプトなど）
  - 分析・要約（データ分析、文書要約など）
  - アイデア出し（ブレインストーミング、企画など）
  - その他（カスタム入力）

- **段階的質問フロー**:
  1. "何についてのプロンプトですか？" （例：ブログ記事の作成）
  2. "主な目的は何ですか？" （例：要約、アイデア出し、画像生成）
  3. "どの AI で使用しますか？" （ChatGPT、Claude、DALL-E 等）
  4. "どのような出力を期待しますか？" （形式、長さ、スタイル等）

**例示・ガイドシステム**:

- **成功例の表示**: カテゴリ別の高評価プロンプト例
- **キーワード提案**: 入力中のリアルタイム候補表示
- **シナリオテンプレート**: よくある用途のテンプレート文

#### 7.2.2 バックエンド要件

**API エンドポイント**:

```
POST /api/intent/analyze
- ユーザーの意図を解析してカテゴリと推奨質問を返す
- 自然言語処理によるキーワード抽出
- 類似プロンプトの検索と提案

GET /api/intent/suggestions
- カテゴリ別の例示とテンプレートを取得
- 人気キーワードとトレンド情報
```

**データ処理**:

- **意図解析 AI**: OpenAI API を使用してユーザー入力を構造化
- **キーワード抽出**: NLP ライブラリによる重要語句の特定
- **カテゴリ分類**: 機械学習モデルによる自動分類
- **類似検索**: ベクトル検索による関連プロンプトの発見

---

### 7.3 フェーズ 2: プロンプト型提示・選択

#### 7.3.1 フロントエンド要件

**型提示 UI**:

- **型カード表示**: 3-5 個の推奨型をカード形式で表示
- **型の構造可視化**: 目的・役割・制約・出力形式の分解表示
- **適用例プレビュー**: 各型の実際の使用例
- **比較テーブル**: 型の特徴と適用場面の比較

```typescript
// プロンプト型の定義
interface PromptTemplate {
  id: string;
  name: string;
  description: string;
  structure: {
    purpose: string; // 目的
    role: string; // 役割
    context: string; // コンテキスト
    constraints: string; // 制約
    format: string; // 出力形式
    examples: string; // 例示
  };
  applicableScenarios: string[];
  difficulty: "beginner" | "intermediate" | "advanced";
  rating: number;
  usageCount: number;
}
```

**カスタマイズエディター**:

- **ブロック式エディター**: 各要素を独立して編集可能
- **ドラッグ&ドロップ**: 要素の順序変更
- **要素追加/削除**: 必要に応じた構造のカスタマイズ
- **リアルタイムプレビュー**: 編集中の型をプレビュー表示

**選択・アクション UI**:

- **「この型を使う」ボタン**: 選択した型でフェーズ 3 へ進行
- **「別の型を提案」ボタン**: AI に追加の型を要求
- **「型をカスタマイズ」ボタン**: エディターモードに切り替え
- **「型を保存」ボタン**: カスタマイズした型をテンプレートとして保存

#### 7.3.2 バックエンド要件

**API エンドポイント**:

```
POST /api/templates/generate
- ユーザーの意図から最適なプロンプト型を生成
- 複数の候補型を返す（3-5個）

GET /api/templates/similar
- 類似の成功例を検索
- 評価の高いテンプレートを優先

POST /api/templates/customize
- ユーザーのカスタマイズを保存
- バリデーションとサニタイゼーション
```

**AI 生成システム**:

- **型生成 AI**: 意図分析結果からプロンプト構造を自動生成
- **成功パターン学習**: 高評価プロンプトのパターン抽出
- **多様性確保**: 異なるアプローチの型を提案
- **適応性評価**: ユーザーの意図との適合度スコアリング

---

### 7.4 フェーズ 3: 実行・テスト

#### 7.4.1 フロントエンド要件

**値入力インターフェース**:

- **変数フィールド**: 型内の{{変数}}を入力フィールドに変換
- **フィールド種別対応**: テキスト、数値、選択肢、ファイル等
- **入力支援**: オートコンプリート、候補提示、バリデーション
- **プレビュー**: 入力値を反映したプロンプト全文の表示

```typescript
// 変数入力フォーム
interface VariableForm {
  variables: PromptVariable[];
  values: Record<string, any>;
  validation: Record<string, string>;
}

interface PromptVariable {
  name: string;
  type: "text" | "number" | "select" | "file" | "date";
  required: boolean;
  placeholder?: string;
  options?: string[]; // select type用
  validation?: RegExp; // バリデーションルール
  description?: string; // ヘルプテキスト
}
```

**AI 実行インターフェース**:

- **AI サービス選択**: 複数の AI モデルから選択
- **パラメータ設定**: temperature、max_tokens 等の詳細設定
- **実行ボタン**: シームレスな API 連携実行
- **外部連携**: ChatGPT 等への直接送信（URL パラメータ経由）

**結果表示**:

- **出力結果表示**: AI の生成結果をリッチテキストで表示
- **実行履歴**: 過去の実行結果を履歴として保存
- **結果比較**: 複数回実行した結果の比較表示
- **メタデータ**: 実行時間、コスト、使用トークン数等

#### 7.4.2 バックエンド要件

**API エンドポイント**:

```
POST /api/prompt/execute
- 完成したプロンプトをAIで実行
- 複数のAIサービスに対応

GET /api/prompt/history
- 実行履歴の取得
- フィルタリング・ソート機能

POST /api/prompt/external-link
- 外部AIサービスへの連携URL生成
```

**AI 統合システム**:

- **マルチ AI 対応**: OpenAI、Anthropic、Google 等の API 統合
- **レート制限管理**: API 使用量の監視と制御
- **結果正規化**: 各 AI サービスの出力を統一フォーマット化
- **エラーハンドリング**: API 障害時の適切な処理

---

### 7.5 フェーズ 4: フィードバック・改善

#### 7.5.1 フロントエンド要件

**簡単フィードバック UI**:

- **感情ボタン**: 👍 いいね / 🤔 うーん / 🙅‍♀️ 全然ダメ
- **スコア評価**: 1-5 星による詳細評価
- **部分ハイライト**: テキストの一部を選択してコメント
- **カテゴリ評価**: 正確性・有用性・創造性・読みやすさ

```typescript
// フィードバックシステム
interface Feedback {
  executionId: string;
  overallRating: 1 | 2 | 3 | 4 | 5;
  emotionRating: "positive" | "neutral" | "negative";
  aspectRatings: {
    accuracy: number;
    usefulness: number;
    creativity: number;
    readability: number;
  };
  textHighlights: TextHighlight[];
  comment?: string;
  suggestedImprovements?: string;
}

interface TextHighlight {
  startIndex: number;
  endIndex: number;
  sentiment: "positive" | "negative";
  comment?: string;
}
```

**フィードバック可視化**:

- **改善効果表示**: "この型は ○○ 点改善されました！"
- **コミュニティ貢献**: "○○ 人が高評価、さらに洗練されました！"
- **改善提案**: "前回のフィードバックを元に改善案があります"
- **統計ダッシュボード**: 個人・コミュニティの改善統計

**自動改善適用 UI**:

- **改善案プレビュー**: 変更前後の比較表示
- **適用選択**: "適用する/しない"の選択肢
- **部分適用**: 改善案の一部のみを選択適用
- **改善履歴**: 過去の改善の記録と効果

#### 7.5.2 バックエンド要件

**API エンドポイント**:

```
POST /api/feedback/submit
- ユーザーフィードバックの受信・保存
- 統計データの更新

GET /api/feedback/analysis
- フィードバック分析結果の取得
- 改善提案の生成

POST /api/template/improve
- フィードバックベースの型改善
- 新バージョンの生成と保存
```

**改善システム**:

- **フィードバック分析 AI**: 評価データから改善点を特定
- **自動改善エンジン**: プロンプト構造の最適化提案
- **A/B テスト**: 改善版と元版の比較テスト
- **学習システム**: コミュニティフィードバックからの継続学習

**統計・分析システム**:

- **改善効果測定**: 評価スコアの推移追跡
- **コミュニティ分析**: 人気パターンと成功要因の抽出
- **個人最適化**: ユーザー別の改善パターン学習
- **トレンド分析**: 効果的なプロンプト要素のトレンド特定

---

### 7.6 データベース設計

**主要テーブル**:

```sql
-- ユーザー意図記録
CREATE TABLE user_intents (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  description TEXT NOT NULL,
  category VARCHAR(50),
  keywords JSONB,
  target_ai VARCHAR(50)[],
  output_type VARCHAR(50),
  created_at TIMESTAMP DEFAULT NOW()
);

-- プロンプト型テンプレート
CREATE TABLE prompt_templates (
  id UUID PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  structure JSONB NOT NULL,
  category VARCHAR(50),
  difficulty VARCHAR(20),
  rating DECIMAL(3,2) DEFAULT 0,
  usage_count INTEGER DEFAULT 0,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- プロンプト実行履歴
CREATE TABLE prompt_executions (
  id UUID PRIMARY KEY,
  template_id UUID REFERENCES prompt_templates(id),
  user_id UUID REFERENCES users(id),
  input_values JSONB NOT NULL,
  ai_service VARCHAR(50) NOT NULL,
  prompt_text TEXT NOT NULL,
  output_result TEXT,
  execution_params JSONB,
  cost_tokens INTEGER,
  execution_time_ms INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);

-- フィードバック
CREATE TABLE feedbacks (
  id UUID PRIMARY KEY,
  execution_id UUID REFERENCES prompt_executions(id),
  user_id UUID REFERENCES users(id),
  overall_rating INTEGER CHECK (overall_rating BETWEEN 1 AND 5),
  emotion_rating VARCHAR(20),
  aspect_ratings JSONB,
  text_highlights JSONB,
  comment TEXT,
  suggested_improvements TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 型改善履歴
CREATE TABLE template_improvements (
  id UUID PRIMARY KEY,
  template_id UUID REFERENCES prompt_templates(id),
  previous_version JSONB,
  new_version JSONB,
  improvement_reason TEXT,
  feedback_count INTEGER,
  avg_rating_before DECIMAL(3,2),
  avg_rating_after DECIMAL(3,2),
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

### 7.7 実装優先度・ロードマップ

#### フェーズ 1: 基本フロー実装（1-2 ヶ月）

- 意図入力 UI
- 基本的な型提示システム
- 型選択・カスタマイズ
- 単一 AI（OpenAI）での実行

#### フェーズ 2: フィードバック系実装（2-3 ヶ月）

- フィードバック収集 UI
- 基本的な統計表示
- 手動での型改善機能

#### フェーズ 3: AI 自動改善実装（3-4 ヶ月）

- フィードバック分析 AI
- 自動改善提案システム
- A/B テスト機能

#### フェーズ 4: 高度機能・最適化（4-6 ヶ月）

- マルチ AI 対応
- 個人最適化学習
- コミュニティ分析ダッシュボード
- 外部 API 連携強化

---

### 7.8 技術スタック

**フロントエンド**:

- React 19 + TypeScript（既存）
- Zustand（状態管理強化）
- React Hook Form（フォーム管理）
- Framer Motion（アニメーション）

**バックエンド**:

- Node.js + Express
- PostgreSQL（メイン DB）
- Redis（キャッシュ・セッション）
- OpenAI API + Anthropic API
- Python（AI 分析部分）

**AI・分析**:

- OpenAI GPT-4（型生成・改善分析）
- LangChain（プロンプトチェーン管理）
- scikit-learn（フィードバック分析）
- Pinecone（ベクトル検索）
